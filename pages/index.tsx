import type { GetServerSideProps } from 'next';
import Head from 'next/head';
import { ReactElement } from 'react';
import { motion } from 'framer-motion';

import { NextPageWithLayout } from '@pages/_app';
import AlbumService from '@services/AlbumService';
import ArtistService from '@services/ArtistService';
import BandService from '@services/BandService';
import AuthorSwiper from '@components/swipers/AuthorSwiper';
import AlbumSwiper from '@components/swipers/AlbumSwiper';
import MainLayout from '@components/layouts/MainLayout';
import Album from '@models/album';
import Artist from '@models/artist';
import Band from '@models/band';
import OnThisDayComponent from '@components/index/OnThisDayComponent';
import AlbumCard from '@components/albums/AlbumCard';
import Link from 'next/link';

interface HomePage {
	newestAlbums: Album[];
	albums: Album[];
	artists: Artist[];
	bands: Band[];
}

const HomePage: NextPageWithLayout<HomePage> = ({ newestAlbums, albums, artists, bands }) => {
	return (
		<>
			<Head>
				<title>PowerfulDB</title>
				<meta name="description" content="Generated by create next app"/>
			</Head>
			<>
				{/*<HomeHero />*/}

				<div id="introduction" className="px-6 md:px-8 lg:px-12 pt-12">
					<h1 className="text-4xl font-bold">
						Hi Kamil! Welcome to PowerfulDB
						<motion.span
							animate={{ rotate: [0, 30, -30, 0] }}
							transition={{ type: 'spring', delay: 1, duration: 1, repeat: Infinity, repeatDelay: 3 }}
							className="inline-block">
							ðŸ‘‹
						</motion.span>
					</h1>
					<p className="pt-2 text-gray-400 max-w-3xl">
						Learn more about your favorite bands and discover new, exciting music opportunities.
						For&nbsp;more&nbsp;information got to <Link href="/about" className="underline">about</Link> section.
					</p>
				</div>

				<div className="pt-12 pb-24 px-6 md:px-8 lg:px-12 flex flex-col gap-20">

					<div className="w-full">
						<h2 className="text-xl md:text-2xl font-bold">Popular albums</h2>
						<hr className="section-hr"/>
						<div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 2xl:grid-cols-6 gap-x-4 lg:gap-x-6 xl:gap-x-8 gap-y-6 md:gap-y-12">
							{albums.map((album) => (
								<AlbumCard key={album.id} album={album} config={{ showArtist: true, showGenres: true }}/>
							))}
						</div>
					</div>

					<div className="w-full">
						<h2 className="text-xl md:text-2xl font-bold">Popular artists</h2>
						<hr className="section-hr"/>
						<AuthorSwiper authors={artists} authorType="artist"/>
					</div>

					<div className="w-full">
						<h2 className="text-xl md:text-2xl font-bold">Popular bands</h2>
						<hr className="section-hr"/>
						<AuthorSwiper authors={bands} authorType="band"/>
					</div>

					<div className="w-full">
						<h2 className="text-xl md:text-2xl font-bold">Newest albums</h2>
						<hr className="section-hr"/>
						<AlbumSwiper albums={newestAlbums}/>
					</div>

					<div className="w-full">
						<h2 className="text-xl md:text-2xl font-bold">On this day...</h2>
						<hr className="section-hr"/>
						<OnThisDayComponent/>
					</div>
				</div>
			</>
		</>
	);
};

export const getServerSideProps: GetServerSideProps = async () => {
	const { results: albums } = await AlbumService.getAlbumList({ page: 1, size: 12 });
	const { results: newestAlbums } = await AlbumService.getAlbumList({ page: 1, size: 24, ordering: '-created_at' });
	const { results: artists } = await ArtistService.getArtistList({ page: 1, size: 24 });
	const { results: bands } = await BandService.getBandList({ page: 1, size: 24 });

	return {
		props: {
			albums,
			newestAlbums,
			artists,
			bands
		}
	};
};

export default HomePage;

HomePage.getLayout = (page: ReactElement) => <MainLayout>{page}</MainLayout>;
