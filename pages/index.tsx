import type { GetStaticProps } from 'next';
import Head from 'next/head';
import { ReactElement } from 'react';

import { NextPageWithLayout } from '@pages/_app';
import AlbumService from '@services/AlbumService';
import ArtistService from '@services/ArtistService';
import BandService from '@services/BandService';
import AuthorSwiper from '@components/swipers/AuthorSwiper';
import AlbumSwiper from '@components/swipers/AlbumSwiper';
import MainLayout from '@components/layouts/MainLayout';
import Album from '@models/album';
import Artist from '@models/artist';
import Band from '@models/band';
import OnThisDayComponent from '@components/index/OnThisDayComponent';
import AlbumCard from '@components/albums/AlbumCard';
import IntroductionComponent from '@components/index/IntroductionComponent';

interface HomePage {
	newestAlbums: Album[];
	albums: Album[];
	artists: Artist[];
	bands: Band[];
}

const HomePage: NextPageWithLayout<HomePage> = ({ newestAlbums, albums, artists, bands }) => {
	return (
		<>
			<Head>
				<title>PowerfulDB</title>
				<meta name="description" content="Generated by create next app"/>
			</Head>
			<>


				<div className="pt-12 pb-24 px-6 md:px-8 lg:px-12 flex flex-col gap-20">
					<IntroductionComponent/>

					<div className="w-full">
						<h2 className="text-xl md:text-2xl font-bold">Popular albums</h2>
						<hr className="section-hr"/>
						<div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 2xl:grid-cols-6 gap-x-4 lg:gap-x-6 xl:gap-x-8 gap-y-6 md:gap-y-12">
							{albums.map((album) => (
								<AlbumCard key={album.id} album={album} config={{ showArtist: true, showGenres: true }}/>
							))}
						</div>
					</div>

					<div className="w-full">
						<h2 className="text-xl md:text-2xl font-bold">Popular artists</h2>
						<hr className="section-hr"/>
						<AuthorSwiper authors={artists} authorType="artist"/>
					</div>

					<div className="w-full">
						<h2 className="text-xl md:text-2xl font-bold">Popular bands</h2>
						<hr className="section-hr"/>
						<AuthorSwiper authors={bands} authorType="band"/>
					</div>

					<div className="w-full">
						<h2 className="text-xl md:text-2xl font-bold">Newest albums</h2>
						<hr className="section-hr"/>
						<AlbumSwiper albums={newestAlbums}/>
					</div>

					<div className="w-full">
						<h2 className="text-xl md:text-2xl font-bold">On this day...</h2>
						<hr className="section-hr"/>
						<OnThisDayComponent/>
					</div>
				</div>
			</>
		</>
	);
};

export const getStaticProps: GetStaticProps = async () => {
	const { results: albums } = await AlbumService.getAlbumList({ page: 1, size: 12 });
	const { results: newestAlbums } = await AlbumService.getAlbumList({ page: 1, size: 24, ordering: '-created_at' });
	const { results: artists } = await ArtistService.getArtistList({ page: 1, size: 24 });
	const { results: bands } = await BandService.getBandList({ page: 1, size: 24 });

	return {
		props: {
			albums,
			newestAlbums,
			artists,
			bands
		},
		revalidate: 60
	};
};

export default HomePage;

HomePage.getLayout = (page: ReactElement) => <MainLayout>{page}</MainLayout>;
